<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flight Search</title>
    <style>
        /* Styling for the flight search form */
        .class-btn.selected {
            background-color: #007bff;
            color: white;
        }
        .container {
            max-width: 600px;
            margin: auto;
        }
        .search-box, .class-selection, .passenger-selection, .search-btn {
            margin: 10px 0;
        }
        #response-display {
            margin-top: 20px;
            padding: 10px;
            background-color: #f4f4f4;
            white-space: pre-wrap;
            border: 1px solid #ccc;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Search Box -->
        <div class="search-box">
            <input type="date" id="date" placeholder="Date" required>
            <input type="text" id="departure" placeholder="Departure airport" required>
            <input type="text" id="destination" placeholder="Destination airport" required>
        </div>

        <!-- Class Selection -->
        <div class="class-selection">
            <button type="button" id="economy" class="class-btn">Economy</button>
            <button type="button" id="premium" class="class-btn">Premium</button>
            <button type="button" id="business" class="class-btn">Business</button>
        </div>
        
        <!-- Passenger Selection -->
        <div class="passenger-selection">
            <label>Adult:</label>
            <button type="button" onclick="updatePassengerCount('adult', -1)">-</button>
            <input type="text" id="adult-count" value="1" readonly>
            <button type="button" onclick="updatePassengerCount('adult', 1)">+</button>
            
            <label>Child:</label>
            <button type="button" onclick="updatePassengerCount('child', -1)">-</button>
            <input type="text" id="child-count" value="0" readonly>
            <button type="button" onclick="updatePassengerCount('child', 1)">+</button>
            
            <label>Infant:</label>
            <button type="button" onclick="updatePassengerCount('infant', -1)">-</button>
            <input type="text" id="infant-count" value="0" readonly>
            <button type="button" onclick="updatePassengerCount('infant', 1)">+</button>
        </div>
        
        <!-- Search Button -->
        <div class="search-btn">
            <button onclick="searchFlights()">üîç Search</button>
        </div>

        <!-- Display the response from the API -->
        <div id="response-display"></div>
    </div>

    <script>
        let selectedClass = '';  

        function handleClassSelection(selectedClassElement) {
            const buttons = document.querySelectorAll('.class-btn');
            buttons.forEach(button => {
                button.classList.remove('selected');
            });
            selectedClassElement.classList.add('selected');
            selectedClass = selectedClassElement.id;
        }

        document.querySelectorAll('.class-btn').forEach(button => {
            button.addEventListener('click', () => handleClassSelection(button));
        });

        function updatePassengerCount(type, change) {
            const countElement = document.getElementById(`${type}-count`);
            let currentCount = parseInt(countElement.value, 10);
            if (currentCount + change >= 0) {
                countElement.value = currentCount + change;
            }
        }

        async function searchFlights() {
            const date = document.getElementById('date').value;
            const departure = document.getElementById('departure').value;
            const destination = document.getElementById('destination').value;
            const adultCount = document.getElementById('adult-count').value;
            const childCount = document.getElementById('child-count').value;
            const infantCount = document.getElementById('infant-count').value;

            // Construct XML data for the request body
            const xmlData = `
                <?xml version="1.0" encoding="UTF-8"?>
                <fareRequest da="true">
                    <flights>
                        <flight depApt="${departure}" dstApt="${destination}" depDate="${date}"/>
                    </flights>
                    <paxes>
                        <paxType code="ADT">${adultCount}</paxType>
                        <paxType code="CHD">${childCount}</paxType>
                        <paxType code="INF">${infantCount}</paxType>
                    </paxes>
                    <class>${selectedClass}</class>
                </fareRequest>
            `;

            try {
                // Send the XML data to the backend
                const response = await fetch("http://127.0.0.1:5000/searchFlights", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/xml"
                    },
                    body: xmlData
                });

                if (response.ok) {
                    const responseText = await response.text();
                    document.getElementById("response-display").innerText = responseText;
                } else {
                    document.getElementById("response-display").innerText = `Error: ${response.status} ${response.statusText}`;
                }
            } catch (error) {
                console.error('Request failed:', error);
                document.getElementById("response-display").innerText = `Request failed: ${error.message}`;
            }
        }
    </script>
</body>
</html>
